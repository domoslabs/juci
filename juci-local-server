#!/usr/bin/nodejs

var express = require('express');
var app = express();
var JSON = require("JSON"); 
var http = require("http"); 
var bodyParser = require('body-parser')
var config = { port: 3000 };

for(var i = 0; i < process.argv.length; i++){
	switch(process.argv[i]){
		case "--port": config.port = parseInt(process.argv[++i]); break; 
	}; 
} 

if(!config.port){
	console.log("	--port <port>"); 
	console.log("		specify port to use for local server"); 
	process.exit(); 
}

app.use( bodyParser.json() );       // to support JSON-encoded bodies
app.use(bodyParser.urlencoded({     // to support URL-encoded bodies
  extended: true
})); 

app.use(express.static(__dirname + '/bin/www'));

var spawn = require('child_process').spawn;

spawn('make', ["debug", "DEFAULT_THEME=y"], { customFds: [0,1,2] })
.on("exit", function(code){
	console.log("Recompiled gui, code: "+code); 
}); 


var server = app.listen(config.port, function () {
	console.log("Local server listening on http://localhost:" + config.port);
});

