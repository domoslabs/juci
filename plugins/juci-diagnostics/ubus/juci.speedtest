#!/bin/sh

. /usr/share/libubox/jshn.sh

case "$1" in
	list)
		echo '{ "run" : {"testmode":"str","packetsize":32,"address":"str","port":32} }'
	;;
	call)
		case "$2" in
			run)
				if pidof tptest-run >/dev/null; then
					json_init
					json_add_string "error" "there is already a speedtest going on"
					json_dump
				else
					read input
					tptest-run "$input" >/dev/null 2>&1 &
					json_init
					json_add_string "success" "speedtest is started"
					json_dump
				fi
			;;
		esac
	;;
esac
